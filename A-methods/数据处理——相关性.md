# 数据处理——相关性

## 01-皮尔逊相关系数

皮尔逊相关系数（\( r \)）用于衡量两个变量之间的线性关系。其公式为：
$$
r = \frac{\text{Cov}(X, Y)}{\sigma_X \sigma_Y}
$$
其中：
- \(\text{Cov}(X, Y)\) 是变量 \( X \) 和 \( Y \) 的协方差。
- \(\sigma_X\) 是变量 \( X \) 的标准差。
- \(\sigma_Y\) 是变量 \( Y \) 的标准差。

### 原理说明：

1. **协方差**：衡量两个变量如何共同变化。协方差为正值表示两个变量趋向于同时增加或减少，为负值则表示一个变量增加时另一个变量减少。
2. **标准差**：衡量单个变量的离散程度。标准差越大，变量的分布越分散。
3. **标准化**：通过将协方差除以标准差，皮尔逊相关系数标准化到[-1, 1]的范围，使其便于比较。这样可以消除量纲的影响，得到一个单位标准的相关性度量。

皮尔逊相关系数的值范围从-1到1：
- **1** 表示完全正线性相关：两个变量总是成正比变化。
- **-1** 表示完全负线性相关：一个变量增加时另一个变量减少，且成比例。
- **0** 表示没有线性相关关系：两个变量的变化无明显线性关系。

```
一个 Python 函数，接收两组数据并计算皮尔逊相关系数，确保输入的两组数据长度相同，输出相关系数，并绘制图表。此函数假设数据是线性的且符合皮尔逊相关系数的前提条件。
```

### 案例分析

- #### 案例1

假设你有两组数据：学生的学习时间（X）和他们的考试成绩（Y）。数据如下：

- 学习时间（小时）：2, 3, 5, 7, 10
- 考试成绩（分数）：50, 55, 60, 65, 80

1. 计算均值：学习时间均值为5.4小时，考试成绩均值为62分。
2. 计算协方差：计算两个变量的协方差，结果为95。
3. 计算标准差：学习时间的标准差约为2.68，考试成绩的标准差约为10.58。
4. 使用公式：r = Cov(X, Y) / (σ_X * σ_Y) = 95 / (2.68 * 10.58) ≈ 0.71。

因此，皮尔逊相关系数约为0.71，表明学习时间和考试成绩之间有较强的正线性关系。

- #### 案例2

假设你有两组数据：月度广告支出（X）和销售额（Y）。数据如下：

- 广告支出（千元）：1, 2, 3, 4, 5
- 销售额（万元）：5, 6, 7, 8, 10

1. 计算均值：广告支出均值为3千元，销售额均值为7万元。
2. 计算协方差：计算得到协方差为2.5。
3. 计算标准差：广告支出的标准差约为1.58，销售额的标准差约为1.58。
4. 使用公式：r = Cov(X, Y) / (σ_X * σ_Y) = 2.5 / (1.58 * 1.58) ≈ 1.00。

这里的皮尔逊相关系数接近1，说明广告支出和销售额之间有非常强的正线性关系。

### 适用性

当然，以下是皮尔逊相关系数适用条件的汇总表格：

| **条件**     | **说明**                                           | **适用场景**                       | **不适用场景**                               |
| ------------ | -------------------------------------------------- | ---------------------------------- | -------------------------------------------- |
| **线性关系** | 衡量变量间的线性关系，即数据点应沿直线分布。       | 数据点在散点图中形成明显直线关系。 | 数据点呈非线性关系，如曲线或其他复杂模式。   |
| **正态分布** | 数据最好接近正态分布，以确保相关系数的可靠性。     | 数据大致呈正态分布。               | 数据分布严重偏斜，如长尾分布。               |
| **连续数据** | 适用于连续数据，数据可以在任意两个点之间取值。     | 体重、身高、温度等连续变量。       | 分类数据（如性别）或顺序数据（如教育水平）。 |
| **均匀分布** | 数据点应在测量范围内分布均匀，而非集中在某些区域。 | 数据在测量范围内均匀分布。         | 数据点主要集中在某些区域。                   |

- **线性关系**：
  - **适用**：学生的学习时间和考试成绩，数据点沿直线分布。
  - **不适用**：股市价格与某些经济指标的关系可能表现出非线性趋势。

- **正态分布**：
  - **适用**：实验室测量的血压数据通常接近正态分布。
  - **不适用**：收入数据通常右偏，需要对数变换或使用其他方法。

- **连续数据**：
  - **适用**：测量温度和湿度。
  - **不适用**：分析性别与工资水平的关系，应使用点二列相关系数。

- **均匀分布**：
  - **适用**：年龄数据在整个年龄段内均匀分布。
  - **不适用**：测试成绩主要集中在高分区间。

### 总结

皮尔逊相关系数是一个强大的工具，但其适用性受限于数据是否符合其假设条件。为了获得准确的相关性度量，确保数据满足以下条件：

- **线性关系**：数据应呈现出线性关系。
- **正态分布**：数据应接近正态分布（虽然不强制要求）。
- **连续数据**：数据应为连续变量。
- **均匀分布**：数据点应在其范围内分布均匀。

如果数据不符合这些条件，可以考虑使用其他相关性测量方法（如斯皮尔曼等级相关系数或肯德尔τ系数），以更好地处理非线性关系、非正态分布或分类数据。

斯皮尔曼等级相关系数（Spearman's Rank Correlation Coefficient）和肯德尔τ系数（Kendall's Tau Coefficient）是用于测量变量之间相关性的非参数统计方法。这两种方法适用于不同的数据类型和分布条件，特别是当数据不满足皮尔逊相关系数的假设时。

## 02-斯皮尔曼等级相关系数

斯皮尔曼等级相关系数（Spearman's Rank Correlation Coefficient）

### 概述

斯皮尔曼等级相关系数用于衡量两个变量的排名（或顺序）之间的相关性。它不要求数据具有正态分布，也不要求变量之间的关系是线性的，只要数据是有序的或可以排序的即可。通过对数据进行排名并计算排名差异，可以不依赖于数据的分布特性来评估变量之间的相关性。

斯皮尔曼等级相关系数的计算公式如下：
$$
\rho = 1 - \frac{6 \sum d_i^2}{n(n^2 - 1)}
$$
其中：
- \( d_i \) 是每对数据的排名差异（即每对数据的等级差的平方）。
- \( n \) 是数据对的总数。

**实现步骤**：

1. **对数据排序**：将每个变量的数据转换为排名。
2. **计算排名差异**：计算每对数据的排名差异 \( d_i \)。
3. **应用公式**：代入公式计算斯皮尔曼等级相关系数。

### **适用性**：
- **适用场景**：适用于有序数据、分类数据或非线性关系的分析。特别有效于数据量较小的情况下，能处理非正态分布数据。
- **不适用场景**：不适合处理纯连续变量，尤其是在数据量很大时，计算可能变得复杂且耗时。对于大规模数据集，可能需要其他更高效的相关性分析方法。

### 结果评价

| **相关系数值 (ρ)** | **解释**             | **结果评价**                                                 |
| ------------------ | -------------------- | ------------------------------------------------------------ |
| **1**              | 完全正相关           | 两个变量的排名完全一致，即一个变量的排名增加时，另一个变量的排名也完全增加。 |
| **0.7 - 0.9**      | 强正相关             | 两个变量的排名大致一致，大部分排名的变化是同步的。           |
| **0.4 - 0.6**      | 中等正相关           | 两个变量的排名有一定程度的同步，但不完全一致，存在差异。     |
| **0 - 0.3**        | 弱正相关或无明显相关 | 两个变量的排名基本无序或仅有轻微的同步。                     |
| **-0.3 - 0**       | 弱负相关             | 两个变量的排名有轻微的反向关系。                             |
| **-0.6 - -0.4**    | 中等负相关           | 两个变量的排名有一定的反向关系，大部分排名的变化是反向的。   |
| **-0.9 - -0.7**    | 强负相关             | 两个变量的排名大致相反，大部分排名的变化是反向的。           |
| **-1**             | 完全负相关           | 两个变量的排名完全相反，即一个变量的排名增加时，另一个变量的排名完全减少。 |

## 03-肯德尔τ系数

### 概述

肯德尔τ系数（Kendall's Tau Coefficient）
肯德尔τ系数用于衡量两个变量之间的顺序关系的相关性。它通过比较每对数据点的相对顺序来评估相关性。肯德尔τ系数特别适用于处理有序分类数据或排名数据。
肯德尔τ系数的计算公式如下：
$$
\tau = \frac{(C - D)}{\sqrt{(C + D + T_1)(C + D + T_2)}}
$$
其中：
- \( C \) 是一致对数（两个变量中对的顺序一致的对数）。
- \( D \) 是不一致对数（两个变量中对的顺序不一致的对数）。
- \( T_1 \) 和 \( T_2 \) 是在两个变量中各自相等的排名对数。

**步骤**：

1. **对数据进行排序**：将每个变量的数据转换为排名。
2. **计算一致对和不一致对**：计算变量对中顺序一致和不一致的对数。
3. **应用公式**：代入公式计算肯德尔τ系数。

### **适用性**：
- **适用场景**：
  - 适用于有序数据或分类数据，尤其是在数据量较小的情况下，计算结果更加显著。
  - 在处理排名数据或非正态分布数据时表现良好，因为肯德尔τ系数不依赖于数据的正态分布假设。
  - 适合于需要评估变量之间顺序关系的场景，例如客户满意度调查、产品排名等，这些场景中变量间的关系表现为排序顺序。

- **不适用场景**：
  - 不适用于纯连续变量的分析，因为肯德尔τ系数主要用于评估排序数据之间的相关性。
  - 当数据量较大时，计算一致对和不一致对可能变得复杂且耗时。对于大规模数据集，计算肯德尔τ系数可能比较繁琐，此时可能需要使用其他更高效的相关性分析方法。

### 评价对比

选择合适的相关性测量方法取决于数据的特性和分析目标。

| 特征               | 斯皮尔曼等级相关系数                           | 肯德尔τ系数                                                |
| ------------------ | ---------------------------------------------- | ---------------------------------------------------------- |
| **适用数据**       | 顺序数据、排名数据                             | 顺序数据、排名数据                                         |
| **适用场景**       | 数据不符合正态分布或不呈现线性关系             | 小数据集，处理顺序关系                                     |
| **计算方式**       | 基于排名差异计算相关系数                       | 基于一致对和不一致对计算相关系数                           |
| **公式**           | \(\rho = 1 - \frac{6 \sum d_i^2}{n(n^2 - 1)}\) | \(\tau = \frac{C - D}{\sqrt{(C + D + T_1)(C + D + T_2)}}\) |
| **结果范围**       | -1 到 1                                        | -1 到 1                                                    |
| **优点**           | 处理非线性关系、适用于较大数据集               | 适用于小数据集、考虑所有数据对                             |
| **缺点**           | 对排名相等的处理可能较复杂                     | 对大数据集计算较为复杂且耗时                               |
| **对数据的敏感度** | 对于排名差异较小的数据较为敏感                 | 对于一致对和不一致对较为敏感，能更全面地反映相关性         |
| **解释**           | 系数越接近 ±1 表示相关性越强                   | 系数越接近 ±1 表示相关性越强                               |

**选择**：

- **斯皮尔曼等级相关系数** 适用于数据量较大且需要处理非正态分布或非线性关系的场景，对排名差异的敏感度较高，通过比较数据的排名来评估相关性，但在排名相等时可能影响计算准确性。
- **肯德尔τ系数** 更适合于小数据集，特别是在需要精确评估所有数据对的情况下，比较数据点的相对顺序来评估相关性，计算时考虑了所有可能的对比对。对数据对一致性和不一致性的敏感度较高。





## 04-点二列相关系数

### 概述

点二列相关系数（Point-Biserial Correlation Coefficient）用于衡量一个二分类变量（也称为名义变量）与一个连续变量之间的关系。它是皮尔逊相关系数的一种特殊形式，适用于一类变量是二分类的情况。

- **适用数据**

- **连续变量**：数据类型是连续的数值型变量。
- **二分类变量**：数据类型是二分类的名义变量，如“是/否”，“男性/女性”等。

点二列相关系数计算的目的是确定二分类变量的两种状态（类别）与连续变量之间的关系。其计算公式如下：

$$
r_{pb} = \frac{M_1 - M_2}{s} \sqrt{\frac{n_1 n_2}{n^2}}
$$

**公式中各符号的含义：**

- \( M_1 \)：二分类变量中第一类别的连续变量均值。
- \( M_2 \)：二分类变量中第二类别的连续变量均值。
- \( s \)：整个样本的标准差。
- \( n_1 \)：第一类别的样本数量。
- \( n_2 \)：第二类别的样本数量。
- \( n \)：样本总数量，即 \( n_1 + n_2 \)。

- **<u>计算步骤</u>**

1. **计算均值**：
   - 计算每个类别（例如“男性”和“女性”）中连续变量的均值 \( M_1 \) 和 \( M_2 \)。
   
2. **计算样本标准差**：
   - 计算整个样本的标准差 \( s \)。
   
3. **计算相关系数**：
   - 将计算得到的均值、标准差和样本大小代入公式中，求得点二列相关系数 \( r_{pb} \)。

- **<u>结果范围</u>**

- **范围**：-1 到 1。
  - **1**：完全正相关，表示第一类别的均值明显高于第二类别。
  - **-1**：完全负相关，表示第一类别的均值明显低于第二类别。
  - **0**：没有线性相关性，表示两个变量之间无明显的线性关系。
  - **值越接近 ±1**，相关性越强。

### 应用

- **分析差异**：用于分析二分类变量（如治疗组和对照组）与连续变量（如测试成绩）的关系。
- **指导决策**：帮助理解不同类别之间在某连续变量上的表现差异，并用于进一步的决策分析。

- **示例**

假设我们有一个关于男性和女性的测试成绩数据，我们可以计算点二列相关系数来评估性别（男性/女性）与测试成绩之间的关系。具体步骤包括计算男性和女性的平均测试成绩，计算整体测试成绩的标准差，然后用上述公式计算点二列相关系数。这可以帮助我们理解性别是否与测试成绩有显著的关系。

### 总结

- 点二列相关系数总结表

| **类别**   | **描述**                                                     |
| ---------- | ------------------------------------------------------------ |
| **优点**   | - **适用性广**：适用于一个连续变量和一个二分类变量之间的关系分析。<br>- **直观性强**：结果范围从-1到1，易于理解相关性强弱。<br>- **简单计算**：公式简单，易于计算，适用于大多数统计软件和编程语言。<br>- **线性关系检测**：能够揭示二分类变量与连续变量之间的线性关系。 |
| **缺点**   | - **假设前提**：假设数据符合正态分布且两组样本的方差相等，这可能不总是成立。<br>- **仅衡量线性关系**：只适用于检测线性关系，对于非线性关系不适用。<br>- **对异常值敏感**：异常值或离群值可能影响结果的准确性。<br>- **忽略其他变量**：不考虑其他潜在的混杂变量，可能导致相关性被误解或不完全。 |
| **适用性** | - **比较两组均值**：分析二分类变量（如治疗组和对照组）在连续变量上的表现差异。<br>- **指导决策**：帮助理解不同类别之间在某连续变量上的表现差异。<br>- **初步相关性分析**：用于初步检查一个二分类变量与连续变量之间的线性相关性。 |

这张表格汇总了点二列相关系数的优点、缺点及其适用性，提供了对该系数的全面理解。

## 05-二列相关系数

### 概述

二列相关系数（Biserial Correlation Coefficient）适用数据。

- **连续变量**：测量结果为连续数值的数据。
- **二分类变量**：假定正态分布的二分类变量，用于表示两个不同的类别（如“成功/失败”、“男/女”）。

**计算方式**  
二列相关系数用于衡量一个连续变量与一个假定正态分布的二分类变量之间的关系。它是用于描述两种类型变量之间线性关系的一种统计量，适用于当二分类变量的每一类别的连续变量服从正态分布时。

**公式**  
$$
r_b = \frac{\mu_1 - \mu_2}{\sigma} \sqrt{\frac{n_1 n_2}{n^2}}
$$

**公式解释**：
- \( \mu_1 \)：第一类别的连续变量均值。
- \( \mu_2 \)：第二类别的连续变量均值。
- \( \sigma \)：整个样本的标准差。
- \( n_1 \)：第一类别的样本数量。
- \( n_2 \)：第二类别的样本数量。
- \( n \)：样本总数量，即 \( n_1 + n_2 \)。

**计算步骤**：
1. **计算均值**：
   - 计算每个类别中连续变量的均值 \( \mu_1 \) 和 \( \mu_2 \)。
   
2. **计算标准差**：
   - 计算整个样本的标准差 \( \sigma \)。
   
3. **计算相关系数**：
   - 将均值、标准差和样本大小代入公式中，求得二列相关系数 \( r_b \)。

**结果范围**：
- **-1 到 1**：相关系数的范围从-1到1，值越接近 ±1 表示相关性越强。
  - **1**：完全正相关，第一类别的均值显著高于第二类别的均值。
  - **-1**：完全负相关，第一类别的均值显著低于第二类别的均值。
  - **0**：没有线性相关性，两个变量之间无明显的线性关系。

**应用**：
- **分析差异**：用于分析两个类别（如治疗组和对照组）在某连续变量（如测试成绩）上的差异。
- **指导决策**：帮助理解不同类别在某连续变量上的表现差异，有助于进一步的决策分析。
- **假设检验**：常用于检验两个组间均值是否存在显著差异，特别是当二分类变量的每一组数据呈正态分布时。

### 总结

| **类别**   | **描述**                                                     |
| ---------- | ------------------------------------------------------------ |
| **优点**   | - **适用性强**：特别适用于一个连续变量和一个假定正态分布的二分类变量。<br>- **线性关系检测**：能够揭示二分类变量与连续变量之间的线性关系。<br>- **均值差异**：提供了二分类变量中不同类别的均值差异的量化。 |
| **缺点**   | - **假设前提**：假设二分类变量的每个类别的连续变量服从正态分布，这可能在实际数据中不完全符合。<br>- **对异常值敏感**：异常值可能影响计算结果。<br>- **仅衡量线性关系**：不适用于非线性关系分析。 |
| **适用性** | - **比较两组均值**：用于分析两组（如男性和女性）在某连续变量上的表现差异。<br>- **指导决策**：帮助理解不同类别在某连续变量上的差异，有助于制定决策。<br>- **假设检验**：用于检验假定正态分布的二分类变量与连续变量之间的关系。 |

## 06-斯图登特 t 相关系数

### 概述

斯图登特 t 相关系数（Student's t correlation coefficient）

适用数据**  

- **数据类型**：用于比较两个独立样本的均值，假设数据是从正态分布中抽取的。
- **主要用途**：用于假设检验，确定两个样本均值之间的差异是否显著。

**计算方式**  
斯图登特 t 相关系数用于检验两个独立样本的均值是否存在显著差异。具体计算步骤如下：

**公式**  
$$
t = \frac{\bar{x} - \bar{y}}{s \sqrt{\frac{1}{n_1} + \frac{1}{n_2}}}
$$

**公式解释**：
- \( \bar{x} \)：第一个样本的均值。
- \( \bar{y} \)：第二个样本的均值。
- \( s \)：样本标准差的估计值，通常计算为两个样本方差的加权平均。
- \( n_1 \)：第一个样本的样本数量。
- \( n_2 \)：第二个样本的样本数量。

**计算步骤**：
1. **计算均值**：
   - 计算两个样本的均值 \( \bar{x} \) 和 \( \bar{y} \)。
   
2. **计算标准差**：
   - 计算两个样本的标准差，并合并成一个总体标准差 \( s \)。
   
3. **计算 t 值**：
   - 将均值差和标准差代入公式中，计算 t 值。

**结果范围**：
- **t 值**：根据 t 分布表和自由度（通常为 \( n_1 + n_2 - 2 \)），确定样本均值差异的显著性。
  - **正值或负值**：t 值的正负表示均值差异的方向。
  - **显著性水平**：t 值的绝对值越大，通常表示两个样本均值之间的差异越显著。

**应用**：
- **均值比较**：用于检验两个独立样本（如实验组和对照组）均值是否存在显著差异。
- **假设检验**：常用于验证统计假设，如药物治疗是否显著改善了病人的健康指标。
- **结果解释**：通过计算的 t 值与临界值比较，判断差异是否显著，从而做出统计推断。

假设我们有两个独立的样本数据，如实验组和对照组的成绩。通过计算 t 值，我们可以检验实验组的均值是否显著高于对照组，从而确定实验处理的有效性。

### 总结表

| **类别**   | **描述**                                                     |
| ---------- | ------------------------------------------------------------ |
| **优点**   | - **显著性检验**：有效用于检验两个独立样本均值之间的显著差异。<br>- **简单易用**：计算和理解相对简单，广泛应用于统计分析中。<br>- **正态分布假设**：适用于样本数据符合正态分布的情况，结果准确。 |
| **缺点**   | - **假设前提**：要求样本数据符合正态分布，且样本方差相等。如果不满足，结果可能不准确。<br>- **样本独立性**：只适用于独立样本，不能用于配对样本或相关样本的数据比较。<br>- **对异常值敏感**：异常值可能显著影响 t 值，导致结果偏差。 |
| **适用性** | - **均值比较**：用于比较两个独立样本（如实验组和对照组）的均值差异是否显著。<br>- **假设检验**：常用于验证假设，如治疗效果或干预措施的效果。<br>- **数据符合条件**：适用于数据符合正态分布且方差相等的情况。 |

这张表格汇总了斯图登特 t 相关系数的优缺点和适用性，帮助理解其应用范围及可能的局限性。

## 07-全部对比

以下是各种相关系数的优点、缺点及其适用性的汇总表格：

| 相关系数                 | **优点**                                     | **缺点**                                         | **适用性**                               |
| ------------------------ | -------------------------------------------- | ------------------------------------------------ | ---------------------------------------- |
| **皮尔逊相关系数**       | - 直观易懂，广泛使用<br>- 适合线性关系       | - 仅适用于正态分布数据<br>- 对离群点敏感         | - 连续变量<br>- 线性关系                 |
| **斯皮尔曼等级相关系数** | - 适用于非正态分布数据<br>- 能处理非线性关系 | - 对排名相等的数据较敏感<br>- 不适合处理大量数据 | - 顺序数据<br>- 排名数据<br>- 非线性关系 |
| **肯德尔τ系数**          | - 适用于小数据集<br>- 评估所有数据对         | - 计算复杂<br>- 对大数据集计算较为繁琐           | - 顺序数据<br>- 排名数据                 |
| **点二列相关系数**       | - 适用于一个连续变量和一个二分类变量         | - 假设二分类变量具有特定分布<br>- 对数据量有要求 | - 连续变量与二分类变量                   |
| **二列相关系数**         | - 适用于假定正态分布的二分类变量和连续变量   | - 假设二分类变量正态分布<br>- 计算复杂           | - 连续变量与正态分布的二分类变量         |
| **斯图登特 t 相关系数**  | - 适用于均值比较<br>- 可用于假设检验         | - 假设数据符合正态分布<br>- 对样本量有要求       | - 样本均值比较<br>- 假设检验             |

**选择建议**：
- **皮尔逊相关系数**：选择适用于正态分布数据且需要评估线性关系的场景。
- **斯皮尔曼等级相关系数**：选择处理非正态分布或非线性关系的数据，尤其是排名数据。
- **肯德尔τ系数**：选择小数据集和需要精确排序关系评估的情况。
- **点二列相关系数**：用于一个连续变量和一个二分类变量的分析。
- **二列相关系数**：用于一个假定正态分布的二分类变量和一个连续变量的关系分析。
- **斯图登特 t 相关系数**：用于样本均值比较和假设检验。